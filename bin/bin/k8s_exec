#!/bin/sh -e
#
# Run arbitrary command on first pod matching pattern.
#
# Example:
#   $ k8s_exec client-worker flask task ping-high-priority
#
# Note: make sure KUBECONFIG environment variable contains path to your K8s config
#

NAME_PATTERN=$1
shift

# Find the first pod matching pattern
POD=$(kubectl get pods -o name | grep $NAME_PATTERN | head -n 1)

echo "Running command in $POD"

kubectl exec -it $POD -- "${@:-bash}"
